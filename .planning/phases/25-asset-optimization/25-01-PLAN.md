---
phase: 25-asset-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/assets/bg-farm.webp
  - src/components/auth/AuthLayout.tsx
  - public/bg-farm.jpg
autonomous: true
requirements: [ASSET-01, ASSET-02]

must_haves:
  truths:
    - "Auth page background image is under 300KB as WebP"
    - "Background image is bundled with AuthLayout chunk via Vite import -- not in public/"
    - "Authenticated users navigating directly to dashboard see zero network requests for the background image"
    - "Gradient overlay and fallback color remain unchanged"
  artifacts:
    - path: "src/assets/bg-farm.webp"
      provides: "Compressed farm background image"
      max_bytes: 307200
    - path: "src/components/auth/AuthLayout.tsx"
      provides: "AuthLayout with Vite-imported WebP background"
      contains: "import bgFarm from"
  key_links:
    - from: "src/components/auth/AuthLayout.tsx"
      to: "src/assets/bg-farm.webp"
      via: "ES module import produces hashed URL at build time"
      pattern: "import bgFarm"
---

<objective>
Convert the 11MB auth background JPEG to a compressed WebP and wire it through Vite's asset pipeline so it code-splits with AuthLayout.

Purpose: The 11MB `public/bg-farm.jpg` loads on every auth page visit regardless of connection speed, and persists in `dist/` where dashboard users can fetch it. After this plan, the image is under 300KB WebP, Vite-processed with a content hash, and only bundled in the AuthLayout chunk — dashboard users never request it.

Output: Compressed `src/assets/bg-farm.webp`, updated AuthLayout import, deleted original.
</objective>

<execution_context>
@C:/Users/Bobits/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bobits/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/25-asset-optimization/25-CONTEXT.md
@src/components/auth/AuthLayout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert bg-farm.jpg to compressed WebP</name>
  <files>src/assets/bg-farm.webp</files>
  <action>
1. Create the `src/assets/` directory:
   ```bash
   mkdir -p src/assets
   ```

2. Convert the image using sharp via npx (one-time, no permanent dependency):
   ```bash
   npx sharp-cli --input public/bg-farm.jpg --output src/assets/bg-farm.webp resize 1920 --withoutEnlargement --format webp --quality 45
   ```

   If `sharp-cli` doesn't work as expected, use a Node.js one-liner instead:
   ```bash
   node -e "const sharp = require('sharp'); sharp('public/bg-farm.jpg').resize(1920, null, { withoutEnlargement: true }).webp({ quality: 45 }).toFile('src/assets/bg-farm.webp').then(info => console.log('Output:', info.size, 'bytes'))"
   ```

   Or install sharp temporarily:
   ```bash
   npx -y -p sharp -p @aspect-build/rules_js node -e "require('sharp')('public/bg-farm.jpg').resize(1920, null, {withoutEnlargement: true}).webp({quality: 45}).toFile('src/assets/bg-farm.webp').then(i => console.log(i.size + ' bytes'))"
   ```

3. Verify the output file size is under 300KB (307,200 bytes):
   ```bash
   stat src/assets/bg-farm.webp
   ```
   If over 300KB, reduce quality to 40 and retry.
  </action>
  <verify>
    <automated>node -e "const fs = require('fs'); const s = fs.statSync('src/assets/bg-farm.webp').size; console.log(s + ' bytes'); if (s > 307200) { console.error('FAIL: over 300KB'); process.exit(1); } console.log('PASS: under 300KB');"</automated>
    <manual>Verify src/assets/bg-farm.webp exists and is under 300KB</manual>
  </verify>
  <done>bg-farm.webp exists in src/assets/ at under 300KB, converted from 11MB JPEG at quality 45 and 1920px width</done>
</task>

<task type="auto">
  <name>Task 2: Wire WebP into AuthLayout and delete original</name>
  <files>src/components/auth/AuthLayout.tsx, public/bg-farm.jpg</files>
  <action>
1. Update `src/components/auth/AuthLayout.tsx`:

   Add an import at the top of the file:
   ```tsx
   import bgFarm from '../../assets/bg-farm.webp';
   ```

   Replace the inline style `backgroundImage` value from:
   ```tsx
   backgroundImage: `linear-gradient(to bottom, rgba(20, 40, 60, 0.9), rgba(10, 30, 20, 0.7)),
     url('/bg-farm.jpg')`,
   ```
   To:
   ```tsx
   backgroundImage: `linear-gradient(to bottom, rgba(20, 40, 60, 0.9), rgba(10, 30, 20, 0.7)),
     url(${bgFarm})`,
   ```

   Keep everything else unchanged:
   - `backgroundColor: '#1a3a2a'` fallback stays
   - `bg-cover bg-center bg-no-repeat` classes stay
   - Secondary gradient overlay div stays
   - Logo, content card, all layout stays

   Note: `vite/client` types already declare `*.webp` modules, so no `vite-env.d.ts` changes needed.

2. Delete the original 11MB file from public/:
   ```bash
   git rm public/bg-farm.jpg
   ```

3. Verify the build works:
   ```bash
   npx tsc -b --noEmit
   npx vite build
   ```

4. Verify the built output:
   - `bg-farm.jpg` should NOT appear in `dist/`
   - `bg-farm-[hash].webp` should appear in `dist/assets/`
  </action>
  <verify>
    <automated>npx tsc -b --noEmit && npx vite build</automated>
    <manual>Verify dist/ contains bg-farm-*.webp in assets/, no bg-farm.jpg in dist root, and AuthLayout references the imported WebP</manual>
  </verify>
  <done>AuthLayout imports WebP via Vite, original JPEG deleted from public/, build succeeds with hashed WebP in dist/assets/</done>
</task>

</tasks>

<verification>
1. `npx tsc -b --noEmit` passes with zero errors
2. `npx vite build` produces successful build
3. `src/assets/bg-farm.webp` exists and is under 300KB
4. `public/bg-farm.jpg` is deleted (not in working tree)
5. `dist/bg-farm.jpg` does NOT exist after build
6. `dist/assets/bg-farm-*.webp` exists after build (hashed filename)
7. `src/components/auth/AuthLayout.tsx` contains `import bgFarm from` and `url(${bgFarm})`
</verification>

<success_criteria>
- Auth background image is compressed WebP under 300KB (ASSET-01)
- Image is Vite-processed with content hash, code-split with AuthLayout chunk (ASSET-02)
- Dashboard users never fetch the background image (it's not in public/)
- Gradient overlay and fallback color unchanged — visual appearance identical
</success_criteria>

<output>
After completion, create `.planning/phases/25-asset-optimization/25-01-SUMMARY.md`
</output>
