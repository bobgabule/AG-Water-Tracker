# Plan 06-01: First/Last Name Support + Auto-Profile Fix

## Goal
Update the invite system to collect and store separate first/last name fields, and fix auto-profile creation to properly populate `first_name` and `last_name` columns.

## Context
The existing invite system uses a single `invited_name` field throughout. The `users` table has separate `first_name`/`last_name` columns with an `auto_display_name` trigger that derives `display_name`. The auto-profile creation in `get_onboarding_status` only sets `display_name`, leaving `first_name`/`last_name` as NULL for invited users.

## Tasks

### Task 1: Database Migration (026_invite_first_last_name.sql)
**File**: `supabase/migrations/026_invite_first_last_name.sql` (NEW)

1. Add `invited_first_name TEXT` and `invited_last_name TEXT` to `farm_invites`
2. Migrate existing data: split `invited_name` on space into first/last
3. Drop `invited_name` column
4. DROP + CREATE `private.invite_user_by_phone_impl` with 5-param signature (p_farm_id, p_phone, p_first_name, p_last_name, p_role)
5. UPDATE `private.get_onboarding_status_impl` to INSERT into users with `first_name, last_name` (trigger handles `display_name`)
6. DROP + CREATE `public.invite_user_by_phone` wrapper with new signature
7. GRANT EXECUTE on new function + NOTIFY pgrst

### Task 2: Update AddUserModal
**File**: `src/components/AddUserModal.tsx`

- Replace single `name` state with `firstName` + `lastName`
- Two side-by-side input fields in a 2-column grid
- Update validation: both required
- Update RPC call: `p_first_name`, `p_last_name`
- Update handleClose to reset both fields

### Task 3: Update PendingInvitesList
**File**: `src/components/PendingInvitesList.tsx`

- Update `FarmInviteRow` interface: `invited_first_name` + `invited_last_name`
- Update SQL query column list
- Update display: `{first} {last}`

### Task 4: Update PowerSync Schema
**File**: `src/lib/powersync-schema.ts`

- Replace `invited_name: column.text` with `invited_first_name: column.text` + `invited_last_name: column.text`

### Task 5: Update Sync Rules Documentation
**File**: `docs/powersync-sync-rules.yaml`

- Replace `invited_name` with `invited_first_name, invited_last_name` in all 3 farm_invites bucket queries
- Note: actual sync rules must be updated on PowerSync dashboard

## Commit Message
```
feat(06-01): split invited_name into first/last name for invite system

- Migration 026: add invited_first_name/last_name columns, update RPCs
- AddUserModal: separate first/last name input fields
- PendingInvitesList: display full name from new columns
- PowerSync schema: replace invited_name with new columns
- get_onboarding_status: auto-create profile with first_name/last_name
```

## Verification
- `npx tsc -b --noEmit` — zero errors
- `npx vite build` — clean build
- No remaining references to `invited_name` or `p_name` in src/
