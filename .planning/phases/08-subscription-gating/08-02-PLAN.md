---
phase: 08-subscription-gating
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/pages/UsersPage.tsx
autonomous: true

must_haves:
  truths:
    - "Farm owner sees seat usage summary on Users page (e.g., '2 of 3 Meter Checkers used')"
    - "Seat usage displays for both admin and meter_checker roles"
    - "Usage counts reflect active members + pending invites (not disabled, not expired)"
    - "When a role is at capacity, its usage line shows a visual indicator (full badge or color)"
  artifacts:
    - path: "src/pages/UsersPage.tsx"
      provides: "Seat usage summary section in Users page"
      contains: "useSeatUsage"
  key_links:
    - from: "src/pages/UsersPage.tsx"
      to: "src/hooks/useSeatUsage.ts"
      via: "hook import and call"
      pattern: "import.*useSeatUsage.*from.*useSeatUsage"
    - from: "src/pages/UsersPage.tsx"
      to: "src/lib/subscription.ts"
      via: "imports PLAN_LIMITS for plan name display"
      pattern: "import.*PLAN_LIMITS.*from.*subscription"
---

<objective>
Add seat usage display to the Users page so farm owners can see their current plan limits.

Purpose: Satisfies SUBS-01 -- farm owners see "2 of 3 Meter Checkers used" style information directly on the Users page (per user decision: Users page only, not Settings or SubscriptionPage).

Output: Modified UsersPage.tsx with seat usage summary section
</objective>

<execution_context>
@C:/Users/Bobits/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bobits/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-subscription-gating/08-01-SUMMARY.md
@src/pages/UsersPage.tsx
@src/hooks/useSeatUsage.ts
@src/lib/subscription.ts
@src/lib/permissions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add seat usage summary to UsersPage</name>
  <files>src/pages/UsersPage.tsx</files>
  <action>
Modify `src/pages/UsersPage.tsx` to display seat usage information. Only show seat usage to users with `manage_users` permission (same guard already used for other admin features on this page).

Changes:

1. Import `useSeatUsage` from `../hooks/useSeatUsage` and `PLAN_LIMITS` from `../lib/subscription`.

2. Call `const seatUsage = useSeatUsage();` at the top of the component (alongside existing hooks).

3. Add a seat usage summary section between the page title ("USERS") and the "Show disabled users" toggle. Render it only when `canManageUsers` is true. Structure:

```tsx
{canManageUsers && seatUsage && (
  <div className="bg-[#dfe4d4] rounded-lg p-3 mb-4">
    <h2 className="text-xs font-semibold text-[#5f7248]/70 uppercase tracking-wider mb-2">
      {PLAN_LIMITS.name} Plan
    </h2>
    <div className="space-y-1">
      {/* Admin seats */}
      <div className="flex items-center justify-between">
        <span className="text-sm text-[#5f7248]">Admins</span>
        <span className={`text-sm font-medium ${seatUsage.admin.isFull ? 'text-red-600' : 'text-[#5f7248]'}`}>
          {seatUsage.admin.used} / {seatUsage.admin.limit}
          {seatUsage.admin.isFull && (
            <span className="ml-1.5 text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full">Full</span>
          )}
        </span>
      </div>
      {/* Meter Checker seats */}
      <div className="flex items-center justify-between">
        <span className="text-sm text-[#5f7248]">Meter Checkers</span>
        <span className={`text-sm font-medium ${seatUsage.meter_checker.isFull ? 'text-red-600' : 'text-[#5f7248]'}`}>
          {seatUsage.meter_checker.used} / {seatUsage.meter_checker.limit}
          {seatUsage.meter_checker.isFull && (
            <span className="ml-1.5 text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full">Full</span>
          )}
        </span>
      </div>
    </div>
  </div>
)}
```

Use the existing green theme (#5f7248 text, #dfe4d4 background) to match the member list cards. When a role is full, switch that line to red-600 text and show a "Full" pill in red-100/red-600.

Do NOT add any upgrade button or contact placeholder here -- that goes in plan 08-03 on the invite form. Do NOT modify AddUserModal in this plan. Keep all existing UsersPage functionality intact.
  </action>
  <verify>Run `npx tsc -b --noEmit` -- no type errors. Run `npm run dev` and visually confirm the seat usage section appears on /users for an admin/grower user.</verify>
  <done>Users page shows "Basic Plan" section with "Admins: X / 1" and "Meter Checkers: X / 3" counts. Full roles show red "Full" indicator. Non-admin users do not see the section.</done>
</task>

</tasks>

<verification>
- `npx tsc -b --noEmit` passes
- UsersPage imports and calls useSeatUsage
- Seat usage section visible only to users with manage_users permission
- Both admin and meter_checker usage displayed with used/limit format
- Full roles show red visual indicator
- All existing UsersPage functionality preserved (member list, toggles, disable/enable, delete)
</verification>

<success_criteria>
- Farm owner visiting /users sees "Basic Plan" with admin and meter_checker seat counts
- Counts accurately reflect active members + pending invites (from useSeatUsage hook)
- At-capacity roles show red "Full" indicator
- Meter checkers do not see seat usage (no manage_users permission)
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-subscription-gating/08-02-SUMMARY.md`
</output>
