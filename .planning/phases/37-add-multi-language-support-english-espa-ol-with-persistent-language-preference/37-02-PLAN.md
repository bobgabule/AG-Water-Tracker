---
phase: 37-add-multi-language-support-english-espa-ol-with-persistent-language-preference
plan: 02
type: execute
wave: 2
depends_on: ["37-01"]
files_modified:
  - src/pages/auth/PhonePage.tsx
  - src/pages/auth/VerifyPage.tsx
  - src/pages/NoSubscriptionPage.tsx
  - src/components/SideMenu.tsx
  - src/components/Header.tsx
  - src/components/ConfirmDialog.tsx
  - src/components/LocationSoftAskModal.tsx
  - src/components/WellLimitModal.tsx
  - src/components/ErrorFallback.tsx
  - src/components/SyncStatusBanner.tsx
  - src/components/MapOfflineOverlay.tsx
  - src/components/LazyErrorBoundary.tsx
  - src/components/PageLoader.tsx
autonomous: true
requirements:
  - I18N-AUTH-NAV

must_haves:
  truths:
    - "Auth pages (Phone, Verify, NoSubscription) render in the selected locale before login"
    - "Side menu labels change instantly when language is switched (Map/Mapa, Well List/Lista de Pozos, etc.)"
    - "Confirm dialogs show translated titles, descriptions, and action buttons"
    - "Error fallbacks, sync banner, and map offline overlay show translated messages"
    - "All toLocaleDateString calls use the locale from useTranslation, not hardcoded 'en-US'"
  artifacts:
    - path: "src/pages/auth/PhonePage.tsx"
      provides: "Translated phone auth page"
      contains: "useTranslation"
    - path: "src/components/SideMenu.tsx"
      provides: "Translated nav labels and logout button"
      contains: "useTranslation"
    - path: "src/components/ConfirmDialog.tsx"
      provides: "Translated default cancel/confirm button text"
      contains: "useTranslation"
  key_links:
    - from: "src/components/SideMenu.tsx"
      to: "src/hooks/useTranslation.ts"
      via: "t() calls for nav labels"
      pattern: "t\\('nav\\."
    - from: "src/pages/auth/PhonePage.tsx"
      to: "src/hooks/useTranslation.ts"
      via: "t() calls for auth strings"
      pattern: "t\\('auth\\."
---

<objective>
Wire translations into authentication pages, navigation (SideMenu + Header), and all shared UI chrome components (modals, error fallbacks, sync banner, offline overlay). After this plan, every piece of app chrome outside of well-specific and data pages speaks the selected language.

Purpose: Auth pages are pre-login and must translate without authentication. Nav and shared chrome are visible on every page.
Output: 13 modified files with useTranslation() wired in.
</objective>

<execution_context>
@C:/Users/Bobits/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bobits/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-add-multi-language-support-english-espa-ol-with-persistent-language-preference/37-CONTEXT.md
@.planning/phases/37-add-multi-language-support-english-espa-ol-with-persistent-language-preference/37-01-SUMMARY.md

# Key files to read for string extraction:
@src/pages/auth/PhonePage.tsx
@src/pages/auth/VerifyPage.tsx
@src/pages/NoSubscriptionPage.tsx
@src/components/SideMenu.tsx
@src/components/Header.tsx
@src/components/ConfirmDialog.tsx
@src/components/LocationSoftAskModal.tsx
@src/components/WellLimitModal.tsx
@src/components/ErrorFallback.tsx
@src/components/SyncStatusBanner.tsx
@src/components/MapOfflineOverlay.tsx
@src/components/LazyErrorBoundary.tsx
@src/components/PageLoader.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire translations into auth pages and SideMenu</name>
  <files>
    src/pages/auth/PhonePage.tsx
    src/pages/auth/VerifyPage.tsx
    src/pages/NoSubscriptionPage.tsx
    src/components/SideMenu.tsx
    src/components/Header.tsx
  </files>
  <action>
For each file, add `import { useTranslation } from '../../hooks/useTranslation'` (adjust path depth as needed), call `const { t, locale } = useTranslation()` at the top of the component, then replace every hardcoded English string with the corresponding `t('key')` call.

**PhonePage.tsx:**
- Title: "Sign in to AG Water Tracker" -> `t('auth.signInTitle')`
- Subtitle: "Enter your phone number" -> `t('auth.enterPhone')`
- Input placeholder: "Phone Number" -> `t('auth.phoneNumber')`
- Button: "Send Code" -> `t('auth.sendCode')`
- Error messages: use `t('auth.invalidPhone')`, `t('auth.sendCodeError')`, etc.
- Offline message: use `t('auth.offlineMessage')`
- Any `toLocaleDateString('en-US', ...)` calls -> `toLocaleDateString(locale, ...)`

**VerifyPage.tsx:**
- Title: "Verify" -> `t('auth.verify')`
- Subtitle with phone interpolation: `t('auth.codeSentTo', { phone })`
- Button: "Verify Code" -> `t('auth.verifyCode')`
- Resend link: "Didn't receive a code?" -> `t('auth.didntReceiveCode')`
- Resend button: "Resend Code" -> `t('auth.resendCode')`
- Error messages: use `t('auth.invalidCode')`, `t('auth.verifyError')`, etc.

**NoSubscriptionPage.tsx:**
- Heading: "No Farm Access" -> `t('auth.noSubscription.title')`
- Body text -> `t('auth.noSubscription.body')`
- Contact message -> `t('auth.noSubscription.contact')`
- Sign out button: "Sign Out" -> `t('common.signOut')`

**SideMenu.tsx:**
- Move `navItems` array INSIDE the component function body (it needs access to `t()`)
- Replace hardcoded labels: `'Map'` -> `t('nav.map')`, `'Well List'` -> `t('nav.wellList')`, `'Reports'` -> `t('nav.reports')`, `'Users'` -> `t('nav.users')`, `'Subscription'` -> `t('nav.subscription')`, `'Language'` -> `t('nav.language')`, `'Settings'` -> `t('nav.settings')`
- Header "Menu" -> `t('nav.menu')`
- Close button aria-label: "Close menu" -> `t('nav.closeMenu')`
- Logout button: "Logout" -> `t('nav.logout')`
- Sign out error: "Failed to sign out. Please try again." -> `t('error.signOutFailed')`

**Header.tsx:**
- "Water Tracker" text -> `t('app.waterTracker')` (or keep as brand name if decided; use translation key)
- Menu button aria-label: "Open menu" -> `t('nav.openMenu')`
  </action>
  <verify>
    <automated>npx tsc -b --noEmit</automated>
    <manual>Switch to Spanish on /language page. Navigate to auth pages and verify all text is in Spanish. Open side menu and verify all nav labels are in Spanish.</manual>
  </verify>
  <done>
    - All 3 auth pages render fully translated text in both languages
    - SideMenu nav labels, header text, and logout button are translated
    - Header aria-labels are translated
    - No hardcoded English strings remain in these 5 files (except brand name "AG" if kept)
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire translations into modals, overlays, and error components</name>
  <files>
    src/components/ConfirmDialog.tsx
    src/components/LocationSoftAskModal.tsx
    src/components/WellLimitModal.tsx
    src/components/ErrorFallback.tsx
    src/components/SyncStatusBanner.tsx
    src/components/MapOfflineOverlay.tsx
    src/components/LazyErrorBoundary.tsx
    src/components/PageLoader.tsx
  </files>
  <action>
For each file, add `useTranslation` import and hook call, then replace hardcoded strings.

**ConfirmDialog.tsx:**
- Default cancel button text: "Cancel" -> `t('common.cancel')`
- Default confirm button text: "Confirm" -> `t('common.confirm')`
- NOTE: ConfirmDialog receives `title` and `description` as props from callers. Callers pass `t()` values — ConfirmDialog itself only needs to translate its DEFAULT button labels. If `cancelLabel` and `confirmLabel` props exist, they override. If they don't have defaults, add `t()` defaults.

**LocationSoftAskModal.tsx:**
- Title: "Enable Location" -> `t('location.enableTitle')`
- Body: location helps message -> `t('location.enableBody')`
- Allow button: "Allow" -> `t('location.allow')`
- Dismiss button: "Not Now" -> `t('location.notNow')`

**WellLimitModal.tsx:**
- Title: "Well Limit Reached" -> `t('limit.wellLimitTitle')`
- Body text -> `t('limit.wellLimitBody')`
- Upgrade button text -> `t('limit.upgrade')`
- Close/dismiss button -> `t('common.close')`

**ErrorFallback.tsx:**
- Title: "Something went wrong" -> `t('error.somethingWrong')`
- Body text -> `t('error.tryAgain')`
- Reload button: "Reload" -> `t('error.reload')`
- NOTE: ErrorFallback is a class component error boundary. If useTranslation() cannot be used directly (class components), wrap the render output in a small functional component or use the store directly: `useLanguageStore.getState().locale` + raw translation lookup. Prefer keeping it simple.

**SyncStatusBanner.tsx:**
- "Syncing..." -> `t('sync.syncing')`
- "Offline" -> `t('sync.offline')`
- "Last synced" -> `t('sync.lastSynced')`
- "Sync error" -> `t('sync.error')`
- Any date formatting: use `locale` from hook for `toLocaleDateString`

**MapOfflineOverlay.tsx:**
- "Offline" -> `t('sync.offline')`
- "Cached tiles only" -> `t('map.cachedTilesOnly')`
- Any other offline messaging text

**LazyErrorBoundary.tsx:**
- Error message strings -> use `t('error.*')` keys
- If class component, same approach as ErrorFallback

**PageLoader.tsx:**
- "Loading..." or spinner text -> `t('common.loading')` if any visible text exists
  </action>
  <verify>
    <automated>npx tsc -b --noEmit</automated>
    <manual>Switch to Spanish. Trigger a confirm dialog (e.g., delete a well) — verify Cancel/Confirm buttons are in Spanish. Check sync banner, error fallback by simulating errors.</manual>
  </verify>
  <done>
    - ConfirmDialog default button labels are translated
    - LocationSoftAskModal, WellLimitModal fully translated
    - ErrorFallback, LazyErrorBoundary show translated error messages
    - SyncStatusBanner shows translated sync states
    - MapOfflineOverlay shows translated offline message
    - All toLocaleDateString calls use locale from useTranslation
    - npx tsc -b --noEmit passes
  </done>
</task>

</tasks>

<verification>
1. `npx tsc -b --noEmit` passes with zero errors
2. Switch to Spanish on /language, then navigate to /auth/phone — all strings in Spanish
3. Open side menu — all nav labels in Spanish (Mapa, Lista de Pozos, Reportes, Usuarios, etc.)
4. Trigger a delete confirmation — dialog buttons show Cancelar/Eliminar
5. No hardcoded English strings remain in any of the 13 modified files (except brand names)
</verification>

<success_criteria>
- 13 files modified with useTranslation() calls replacing all hardcoded strings
- Auth flow fully translated (pre-login pages work in Spanish)
- Side menu and header translate instantly on language switch
- Shared modals and error states translate correctly
</success_criteria>

<output>
After completion, create `.planning/phases/37-add-multi-language-support-english-espa-ol-with-persistent-language-preference/37-02-SUMMARY.md`
</output>
